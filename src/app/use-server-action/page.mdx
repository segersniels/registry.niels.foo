import Source from "@/components/source";

# use-server-action

The `useServerAction` hook simplifies server action calls in Next.js client components. It manages loading, error, and data states, automatically executes on mount, and provides a `refresh` function.
This hook reduces boilerplate, improves code organization, and is especially useful in Next.js applications with the App Router, streamlining server-client integration.

## Usage

```tsx
"use client";

import { useEffect, useState } from "react";

import useServerAction from "@/hooks/use-server-action";

function getRandomName() {
  const names = [
    "Alice",
    "Bob",
    "Charlie",
    "David",
    "Emma",
    "Frank",
    "Grace",
    "Henry",
    "Isabel",
    "Jack",
  ];

  const randomIndex = Math.floor(Math.random() * names.length);
  return names[randomIndex];
}

export default function Example() {
  const [shouldFetch, setShouldFetch] = useState(false);
  const { data, error, isLoading, refresh } = useServerAction(
    async () => {
      return `Hello ${getRandomName()}!`;
    },
    { shouldFetch, initialData: "Hello World!" }
  );

  // Refresh the data every second
  useEffect(() => {
    const interval = setInterval(() => {
      refresh();
    }, 1000);

    return () => clearInterval(interval);
  }, [refresh]);

  // Conditionally control whether to start fetching the data
  useEffect(() => {
    const timer = setTimeout(() => {
      setShouldFetch(true);
    }, 5000);

    return () => clearTimeout(timer);
  }, []);

  if (isLoading) {
    return <div>Loading...</div>;
  }

  if (error) {
    return <div>Error: {error.message}</div>;
  }

  return <div>{data}</div>;
}
```

## Installation

```bash
npx shadcn add "https://registry.niels.foo/use-server-action.json"
```

## Source

<Source name="use-server-action" />
